<html>
	<head>
		<title>Gravity</title>
		<script type="text/javascript">
		function deg2rad(x) {
			return x / 180 * Math.PI;
		}

		function Ship(x, y) {
			this.posX = x;
			this.posY = y;

			this.acclY = 0;
			this.speeY = 0;
			this.gravY = -9.81;
			this.engine = 0;

			this.acclX = 0;
			this.speeX = 0;

			this.rotation = 0;
		}

		Ship.prototype.drawX = function() {
			return this.posX * 6;
		}

		Ship.prototype.drawY = function() {
			return this.posY * 6;
		}

		Ship.prototype.drawRotation = function() {
			return this.rotation * Math.PI / 180;
		}

		Ship.prototype.update = function() {
			if ( this.rotation != 0 ) {
				if ( this.rotation > 0 ) {
					var sinEngine = this.engine / Math.sin(deg2rad(90));
					this.acclX = sinEngine * Math.sin(deg2rad(this.rotation)) * -1;
					this.acclY = sinEngine * Math.sin(deg2rad(90-this.rotation));
				} else {
					var sinEngine = this.engine / Math.sin(deg2rad(90));
					this.acclX = sinEngine * Math.sin(deg2rad(this.rotation*-1));
					this.acclY = sinEngine * Math.sin(deg2rad(90-this.rotation*-1));
				}
			} else {
				this.acclY = this.engine;
				this.acclX = 0;
			}

			this.speeY = this.speeY - ( this.gravY + this.acclY ) * 0.05;
			this.speeX = this.speeX - this.acclX * 0.05;

			this.posY  = this.speeY * 0.05 + this.posY;
			this.posX  = this.speeX * 0.05 + this.posX;

			if ( this.posY > 80 ) {
				this.posY   = 80;
				this.speedY = 0;
				this.gravY  = 0;
				this.acclY  = 0;
				this.speeX  = 0;
				this.acclX  = 0;
			} else {
				this.gravY  = -9.81;
			}

		}

		Ship.prototype.draw = function(ctx) {
			ctx.save();
				ctx.translate(this.drawX(), this.drawY());

				ctx.rotate(this.drawRotation());

				ctx.drawImage(img, -16, -16);

				ctx.fillRect(-3, 18, 6, this.engine); 
			ctx.restore();
		}

		Ship.prototype.clear = function(ctx) {
			ctx.clearRect(this.drawX()-40, this.drawY()-40, 80, 80);
		}

		function update() {
			obj.clear(ctx);
			obj.update();
			obj.draw(ctx);
		}

		function keyDownHandler(e) {
			if ( e.keyCode == 83 ) { // S
				obj.engine = 20;
			}

			if ( e.keyCode == 65 ) { // A
				obj.rotation = obj.rotation - 5;
			}

			if ( e.keyCode == 68 ) { // D
				obj.rotation = obj.rotation + 5;
			}
		}

		function keyUpHandler(e) {
			if ( e.keyCode == 83 ) { // S
				obj.engine = 0;
			}
		}

		var obj;
		var canvas;
		var ctx;
		var img;

		function init() {
			obj    = new Ship(41, 10);
			canvas = document.getElementById('canvas');

			ctx           = canvas.getContext('2d');
			ctx.fillStyle = "rgb(200,0,0)";

			img     = new Image();
			img.src = 'ressource/ship.png';

			setInterval(update, 50);
			addEventListener("keydown", keyDownHandler, true);
			addEventListener("keyup", keyUpHandler, true);
		}
		</script>
		<style type="text/css">
		canvas { border: 1px solid black; }
		</style>
	</head>
	<body onload="init();">
		<canvas id="canvas" width="500" height="500"></canvas>
	</body>
</html>
